<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div id="map" style="width:500px;height:400px;"></div>
    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=328cb15b1683e3373464843a3b021137&libraries=LIBRARY"></script>
    
    <script>
        const url="http://api.visitkorea.or.kr/openapi/service/rest/Odii/themeBasedList?ServiceKey=NMkqyt6Aa3btvojAdCg4d4TaYCzoUlImPS4KTBTrHgR16DeKH%2FBuZTIh6V923eDDs%2BdlZ14cMA6ZbsLB2ISdHw%3D%3D&MobileOS=ETC&MobileApp=AppTest&_type=json&numOfRows=500&langCode=ko";
      
        //이야기 
        //const url ="http://api.visitkorea.or.kr/openapi/service/rest/Odii/storyBasedList?ServiceKey=NMkqyt6Aa3btvojAdCg4d4TaYCzoUlImPS4KTBTrHgR16DeKH%2FBuZTIh6V923eDDs%2BdlZ14cMA6ZbsLB2ISdHw%3D%3D&MobileOS=ETC&MobileApp=AppTest&_type=json&numOfRows=500&langCode=ko";
        var container = document.getElementById('map'); //지도를 담을 영역의 DOM 레퍼런스
        var options = { //지도를 생성할 때 필요한 기본 옵션
	        center: new kakao.maps.LatLng(37.55321, 126.972613), //지도의 중심좌표.33.450701, 126.570667
	        level: 12, //지도의 레벨(확대, 축소 정도)
            mapTypeId : kakao.maps.MapTypeId.ROADMAP// 지도종류
        };

        var map = new kakao.maps.Map(container, options); //지도 생성 및 객체 리턴
        
        // 마커 클러스터러를 생성합니다 
        var clusterer = new kakao.maps.MarkerClusterer({
        map: map, // 마커들을 클러스터로 관리하고 표시할 지도 객체 
        averageCenter: true, // 클러스터에 포함된 마커들의 평균 위치를 클러스터 마커 위치로 설정 
        minLevel: 10 // 클러스터 할 최소 지도 레벨 
        });

        // 인포윈도우를 표시하는 클로저를 만드는 함수입니다.
        function makeOverListener(map, marker, infowindow) {
            return function(){
                infowindow.open(map, marker);
            };
        };

        // 인포윈도우를 닫는 클로저를 만드는 함수입니다.
        function makeOutListener(infowindow){
            return function(){
                infowindow.close();
            };
        };


        fetch(url)
        .then((res) => res.json())
        .then((myJson) => {
            var markers = [];
            const item = myJson.item;
            for (var i = 0; i<item.length; i++){
                //지도에 마커를 생성하고 표시한다.
                var marker = new kakao.maps.Marker({
                    position: new kakao.maps.LatLng(
                        item[i]["mapY"],
                        item[i]["mapX"]
                    )//마커의 좌표
                });

                //인포윈도우를 생성합니다.
                var infowindow = new kakao.maps.infowindow({
                    content: item[i]["addr1"],
                });
                
                markers.push(marker);
                kakao.maps.event.addListener(
                    marker,
                    "mouseover",
                    makeOverListener(map, marker, infowindow)
                );
                kakao.maps.event.addListener(
                    marker,
                    "mouseout",
                    makeOutListener(infowindow)
                );
            };
            //클러스터에 마커들을 추가합니다.
            clusterer.addMarkers(markers);
        });

    </script>
</body>
</html>